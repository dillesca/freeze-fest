<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ cast_state.event.name }} â€¢ Live Cast</title>
    <link rel="icon" type="image/png" href="{{ request.url_for('static', path='img/freezefest.png') }}">
    <link rel="stylesheet" href="{{ request.url_for('static', path='css/style.css') }}">
  </head>
  <body class="cast-body">
    <main class="cast-layout">
      <section class="cast-photo">
        <div class="cast-photo__frame">
          {% if cast_state.photos %}
          <img
            src="{{ cast_state.photos[0].image_url }}"
            alt="Freeze Fest event highlight"
            loading="lazy"
            data-cast-photo
          />
          {% else %}
          <div class="cast-photo__placeholder" data-cast-photo-placeholder>
            <p>No photos yet. Upload highlights to start the slideshow.</p>
          </div>
          {% endif %}
        </div>
      </section>

      <aside class="cast-info">
        <div class="cast-info__summary">
          <header class="cast-info__header">
            <div class="cast-info__logo">
              <img src="{{ request.url_for('static', path='img/freezefest.png') }}" alt="Freeze Fest mascot" />
            </div>
            <div class="cast-info__titles">
              <h1>{{ cast_state.event.name }}</h1>
            </div>
          </header>

          {% if cast_state.semifinalists %}
          <section class="cast-semis" aria-label="Leaderboard">
            <header class="cast-semis__header">
              <h2>Leaderboard</h2>
              <span class="cast-semis__note">Top four in semifinals</span>
            </header>
            <ol class="cast-semis__list">
              {% for team in cast_state.semifinalists %}
              <li class="cast-semis__item {% if loop.index <= 4 %}cast-semis__item--qualified{% endif %}">
                <span class="cast-semis__rank">#{{ loop.index }}</span>
                <div class="cast-semis__body">
                  <p class="cast-semis__name">{{ team.name }}</p>
                  {% if team.score is not none %}
                  <p class="cast-semis__meta">Score: {{ team.score }}</p>
                  {% else %}
                  <p class="cast-semis__meta">{{ team.status.replace('_', ' ') if team.status else 'Pending' }}</p>
                  {% endif %}
                </div>
              </li>
              {% endfor %}
            </ol>
          </section>
          {% endif %}
        </div>

        <section class="cast-games" data-cast-games>
          {% if cast_state.games %}
            {% for item in cast_state.games %}
            <article class="cast-card">
              <h2>{{ item.game }}</h2>
              <div class="cast-card__section">
                <h3>Playing Now</h3>
                <p class="cast-card__value" data-role="current">
                  {% if item.current %}
                    {% if item.current.is_bye %}
                      {{ item.current.team1 }} (solo run)
                    {% elif item.current.team2 %}
                      {{ item.current.team1 }} vs {{ item.current.team2 }}
                    {% else %}
                      {{ item.current.team1 }}
                    {% endif %}
                  {% elif item.remaining == 0 %}
                    All matches complete
                  {% else %}
                    Waiting for the next teams
                  {% endif %}
                </p>
              </div>
              <div class="cast-card__section">
                <h3>On Deck</h3>
                <p class="cast-card__value" data-role="next">
                  {% if item.next %}
                    {% if item.next.is_bye %}
                      {{ item.next.team1 }} (solo run)
                    {% elif item.next.team2 %}
                      {{ item.next.team1 }} vs {{ item.next.team2 }}
                    {% else %}
                      {{ item.next.team1 }}
                    {% endif %}
                  {% elif item.remaining == 0 %}
                    Tournament finished for this game
                  {% else %}
                    Stand by for assignments
                  {% endif %}
                </p>
              </div>
            </article>
            {% endfor %}
          {% else %}
            <article class="cast-card cast-card--empty">
              <h2>Matches</h2>
              <p class="cast-card__value">Match assignments will appear here as soon as the tournament begins.</p>
            </article>
          {% endif %}
        </section>
      </aside>
    </main>

    <script>
      window.CAST_STATE = {{ cast_state | tojson }};
    </script>
    <script src="https://www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js" defer></script>
    <script src="{{ request.url_for('static', path='js/cast.js') }}" defer></script>
    <script>
      window.addEventListener("load", () => {
        const hasCastFramework = window.cast && window.cast.framework;
        if (!hasCastFramework) {
          return;
        }

        const context = window.cast.framework.CastReceiverContext.getInstance();
        context.setInactivityTimeout(3600);
        context.start({ statusText: "Freeze Fest Live" });
      });
    </script>
  </body>
</html>
